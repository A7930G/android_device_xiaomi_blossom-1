From d22ce0ee77dd940adfefde47f4251e608435c170 Mon Sep 17 00:00:00 2001
From: Ionut Gherman <ghermanionut96@gmail.com>
Date: Thu, 23 May 2024 12:34:08 +0300
Subject: [PATCH] PixelPropsUtils: Update Spoof fingerprint

*fixed, again (credit to PlayIntegrityFix team)
Signed-off-by: Ionut Gherman <ghermanionut96@gmail.com>
Signed-off-by: Pranav Vashi <neobuddy89@gmail.com>
---
 .../internal/util/bliss/PixelPropsUtils.java  | 31 ++++++++++++++-----
 1 file changed, 24 insertions(+), 7 deletions(-)

diff --git a/core/java/com/android/internal/util/bliss/PixelPropsUtils.java b/core/java/com/android/internal/util/bliss/PixelPropsUtils.java
index 109eef08..b5c88a83 100644
--- a/core/java/com/android/internal/util/bliss/PixelPropsUtils.java
+++ b/core/java/com/android/internal/util/bliss/PixelPropsUtils.java
@@ -235,15 +235,32 @@ public class PixelPropsUtils {
         }
     }
 
+    private static void setVersionFieldString(String key, String value) {
+        try {
+            // Unlock
+            Field field = Build.VERSION.class.getDeclaredField(key);
+            field.setAccessible(true);
+
+            // Edit
+            field.set(null, value);
+
+            // Lock
+            field.setAccessible(false);
+        } catch (NoSuchFieldException | IllegalAccessException e) {
+            Log.e(TAG, "Failed to spoof Build." + key, e);
+        }
+    }
+
     private static void spoofBuildGms() {
         // Alter model name and fingerprint to avoid hardware attestation enforcement
-        setPropValue("PRODUCT", "WW_Phone");
-        setPropValue("DEVICE", "ASUS_X00HD_4");
-        setPropValue("MANUFACTURER", "Asus");
-        setPropValue("BRAND", "Asus");
-        setPropValue("MODEL", "ASUS_X00HD");
-        setPropValue("FINGERPRINT", "asus/WW_Phone/ASUS_X00HD_4:7.1.1/NMF26F/14.2016.1801.372-20180119:user/release-keys");
-        setVersionField("DEVICE_INITIAL_SDK_INT", Build.VERSION_CODES.N_MR1);
+        setPropValue("PRODUCT", "sailfish");
+        setPropValue("DEVICE", "sailfish");
+        setPropValue("MANUFACTURER", "Google");
+        setPropValue("BRAND", "google");
+        setPropValue("ID", "OPM1.171019.011");
+        setPropValue("MODEL", "Pixel");
+        setPropValue("FINGERPRINT", "google/sailfish/sailfish:8.1.0/OPM1.171019.011/4448085:user/release-keys");
+        setVersionFieldString("SECURITY_PATCH", "2017-12-05");
     }
 
     private static boolean isCallerSafetyNet() {
-- 
2.44.0

